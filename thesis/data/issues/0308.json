{
  "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308",
  "repository_url": "https://api.github.com/repos/olafurpg/scalafmt",
  "labels_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308/labels{/name}",
  "comments_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308/comments",
  "events_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308/events",
  "html_url": "https://github.com/olafurpg/scalafmt/issues/308",
  "id": 158310623,
  "number": 308,
  "title": "the formatted results diff between scalafmt plugin in intellij and cli",
  "user": {
    "login": "windfansy",
    "id": 16920086,
    "avatar_url": "https://avatars.githubusercontent.com/u/16920086?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/windfansy",
    "html_url": "https://github.com/windfansy",
    "followers_url": "https://api.github.com/users/windfansy/followers",
    "following_url": "https://api.github.com/users/windfansy/following{/other_user}",
    "gists_url": "https://api.github.com/users/windfansy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/windfansy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/windfansy/subscriptions",
    "organizations_url": "https://api.github.com/users/windfansy/orgs",
    "repos_url": "https://api.github.com/users/windfansy/repos",
    "events_url": "https://api.github.com/users/windfansy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/windfansy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "milestone": null,
  "comments": [
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/223515549",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/308#issuecomment-223515549",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308",
      "id": 223515549,
      "user": {
        "login": "olafurpg",
        "id": 1408093,
        "avatar_url": "https://avatars.githubusercontent.com/u/1408093?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/olafurpg",
        "html_url": "https://github.com/olafurpg",
        "followers_url": "https://api.github.com/users/olafurpg/followers",
        "following_url": "https://api.github.com/users/olafurpg/following{/other_user}",
        "gists_url": "https://api.github.com/users/olafurpg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/olafurpg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/olafurpg/subscriptions",
        "organizations_url": "https://api.github.com/users/olafurpg/orgs",
        "repos_url": "https://api.github.com/users/olafurpg/repos",
        "events_url": "https://api.github.com/users/olafurpg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/olafurpg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-06-03 07:59:40 UTC",
      "updated_at": "2016-06-03 07:59:40 UTC",
      "body": "I am not able to reproduce this issue. How did you install the CLI?"
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/223519544",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/308#issuecomment-223519544",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308",
      "id": 223519544,
      "user": {
        "login": "windfansy",
        "id": 16920086,
        "avatar_url": "https://avatars.githubusercontent.com/u/16920086?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/windfansy",
        "html_url": "https://github.com/windfansy",
        "followers_url": "https://api.github.com/users/windfansy/followers",
        "following_url": "https://api.github.com/users/windfansy/following{/other_user}",
        "gists_url": "https://api.github.com/users/windfansy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/windfansy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/windfansy/subscriptions",
        "organizations_url": "https://api.github.com/users/windfansy/orgs",
        "repos_url": "https://api.github.com/users/windfansy/repos",
        "events_url": "https://api.github.com/users/windfansy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/windfansy/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-06-03 08:21:13 UTC",
      "updated_at": "2016-06-03 08:21:13 UTC",
      "body": "my scalafmt cmd\r\n```bash\r\n#!/bin/sh\r\njava -Dfile.encoding=utf-8 -jar /e/Code/Apis/scalafmt/cli/target/scala-2.11/scalafmt.jar $@\r\n\r\n```\r\ni run git-bash on Windows 10 and add scalafmt path in .bashrc\r\n`PATH=$PATH:/e/Code/Apis/scalafmt/bin`"
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/223520731",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/308#issuecomment-223520731",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308",
      "id": 223520731,
      "user": {
        "login": "olafurpg",
        "id": 1408093,
        "avatar_url": "https://avatars.githubusercontent.com/u/1408093?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/olafurpg",
        "html_url": "https://github.com/olafurpg",
        "followers_url": "https://api.github.com/users/olafurpg/followers",
        "following_url": "https://api.github.com/users/olafurpg/following{/other_user}",
        "gists_url": "https://api.github.com/users/olafurpg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/olafurpg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/olafurpg/subscriptions",
        "organizations_url": "https://api.github.com/users/olafurpg/orgs",
        "repos_url": "https://api.github.com/users/olafurpg/repos",
        "events_url": "https://api.github.com/users/olafurpg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/olafurpg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-06-03 08:27:15 UTC",
      "updated_at": "2016-06-03 08:27:15 UTC",
      "body": "Do you build `cli/target/scala-2.11/scalafmt.jar` yourself? If so, from which commit?"
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/223522618",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/308#issuecomment-223522618",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308",
      "id": 223522618,
      "user": {
        "login": "windfansy",
        "id": 16920086,
        "avatar_url": "https://avatars.githubusercontent.com/u/16920086?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/windfansy",
        "html_url": "https://github.com/windfansy",
        "followers_url": "https://api.github.com/users/windfansy/followers",
        "following_url": "https://api.github.com/users/windfansy/following{/other_user}",
        "gists_url": "https://api.github.com/users/windfansy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/windfansy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/windfansy/subscriptions",
        "organizations_url": "https://api.github.com/users/windfansy/orgs",
        "repos_url": "https://api.github.com/users/windfansy/repos",
        "events_url": "https://api.github.com/users/windfansy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/windfansy/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-06-03 08:36:16 UTC",
      "updated_at": "2016-06-03 08:36:16 UTC",
      "body": "no, i download it from release page\r\n![image](https://cloud.githubusercontent.com/assets/16920086/15773401/434261cc-29a9-11e6-822f-b9eb1738c769.png)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/223524359",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/308#issuecomment-223524359",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308",
      "id": 223524359,
      "user": {
        "login": "olafurpg",
        "id": 1408093,
        "avatar_url": "https://avatars.githubusercontent.com/u/1408093?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/olafurpg",
        "html_url": "https://github.com/olafurpg",
        "followers_url": "https://api.github.com/users/olafurpg/followers",
        "following_url": "https://api.github.com/users/olafurpg/following{/other_user}",
        "gists_url": "https://api.github.com/users/olafurpg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/olafurpg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/olafurpg/subscriptions",
        "organizations_url": "https://api.github.com/users/olafurpg/orgs",
        "repos_url": "https://api.github.com/users/olafurpg/repos",
        "events_url": "https://api.github.com/users/olafurpg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/olafurpg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-06-03 08:44:27 UTC",
      "updated_at": "2016-06-03 08:44:27 UTC",
      "body": "I'm still unable to reproduce the issue. I run the 0.2.5 CLI release and 0.2.5 release in InteliiJ. Do you have a .scalafmt file in your home directory?"
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/223533207",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/308#issuecomment-223533207",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308",
      "id": 223533207,
      "user": {
        "login": "windfansy",
        "id": 16920086,
        "avatar_url": "https://avatars.githubusercontent.com/u/16920086?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/windfansy",
        "html_url": "https://github.com/windfansy",
        "followers_url": "https://api.github.com/users/windfansy/followers",
        "following_url": "https://api.github.com/users/windfansy/following{/other_user}",
        "gists_url": "https://api.github.com/users/windfansy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/windfansy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/windfansy/subscriptions",
        "organizations_url": "https://api.github.com/users/windfansy/orgs",
        "repos_url": "https://api.github.com/users/windfansy/repos",
        "events_url": "https://api.github.com/users/windfansy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/windfansy/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-06-03 09:27:24 UTC",
      "updated_at": "2016-06-03 09:27:24 UTC",
      "body": "i check, there's no .scalafmt in my home or project directory"
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/223533419",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/308#issuecomment-223533419",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/308",
      "id": 223533419,
      "user": {
        "login": "windfansy",
        "id": 16920086,
        "avatar_url": "https://avatars.githubusercontent.com/u/16920086?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/windfansy",
        "html_url": "https://github.com/windfansy",
        "followers_url": "https://api.github.com/users/windfansy/followers",
        "following_url": "https://api.github.com/users/windfansy/following{/other_user}",
        "gists_url": "https://api.github.com/users/windfansy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/windfansy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/windfansy/subscriptions",
        "organizations_url": "https://api.github.com/users/windfansy/orgs",
        "repos_url": "https://api.github.com/users/windfansy/repos",
        "events_url": "https://api.github.com/users/windfansy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/windfansy/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-06-03 09:28:21 UTC",
      "updated_at": "2016-06-03 09:28:21 UTC",
      "body": "maybe i should check in another machine"
    }
  ],
  "created_at": "2016-06-03 07:51:08 UTC",
  "updated_at": "2016-06-03 09:28:21 UTC",
  "closed_at": null,
  "body": "Original:\r\n```scala\r\n// ======================================================================\r\n//\r\n//      Copyright (C) 北京国双科技有限公司\r\n//                    http://www.gridsum.com\r\n//\r\n//      保密性声明：此文件属北京国双科技有限公司所有，仅限拥有由国双科技\r\n//      授予了相应权限的人所查看和所修改。如果你没有被国双科技授予相应的\r\n//      权限而得到此文件，请删除此文件。未得国双科技同意，不得查看、修改、\r\n//      散播此文件。\r\n//\r\n//\r\n// ======================================================================\r\n\r\npackage com.gridsum.spark.wd\r\n\r\nimport org.apache.hadoop.hbase.HBaseConfiguration\r\nimport org.slf4j.LoggerFactory\r\n\r\nimport com.gridsum.spark.wd.external.HBaseUserVisitInfoComponent\r\nimport com.gridsum.spark.wd.session.{SessionDataComponent, SessionGenerator, UserSessionDataAggregator}\r\nimport com.gridsum.wd.metadata.model.{ProfileType, ProfileConfig}\r\nimport com.gridsum.weblog.parser.wd.scala.configuration.DefaultWdProfileConfigService\r\nimport com.gridsum.weblog.parser.wd.scala.dataobject._\r\n\r\n/**\r\n  * process all sessions in an individual partition.\r\n  * @param index RDD partition index.\r\n  * @param dataPerProfileUser iterator of the partition collection.\r\n  *                           each item is a key-value pair, with key as instance of CombinedId,\r\n  *                           and value as all WdBaseDataObjects belonged to the user.\r\n  * @param outputBasePath the base output path for writing DataObject Avro/Parquet files.\r\n  *                       the absolute path is:\r\n  *                       hdfs://$outputPath/$DataObject/year=$year/month=$month/day=$day/part-r-index.parquet\r\n  * @param dateStr the date for which day's date to process, in the format of 'yyyyMMdd'\r\n  * @param hadoopConfigProvider the configuration object passed in, all instances of PartitionProcessor\r\n  *                             will use the same instance\r\n  */\r\nclass PartitionProcessor(\r\n    index: Int,\r\n    dataPerProfileUser: Iterator[(CombinedId, Iterable[WdBaseDataObject])],\r\n    outputBasePath: String,\r\n    dateStr: String,\r\n    hadoopConfigProvider: HadoopConfigurationProvider,\r\n    profileConfigMap: Map[Int, ProfileConfig],\r\n    sourceUserTable: Option[String],\r\n    eqIdMap: Map[String, String])\r\n    extends SessionDataComponent\r\n    with ParquetOutputComponent\r\n    with HBaseUserVisitInfoComponent\r\n    with SessionGenerator {\r\n  self =>\r\n\r\n  import PartitionProcessor._\r\n\r\n  private val wdProfileConfigService = new DefaultWdProfileConfigService(\r\n      profileConfigMap)\r\n\r\n  type Config = AllConfig\r\n\r\n  // wire in the actual configuration information for all the components here\r\n  trait AllConfig extends HBaseConfig with ParquetOutputConfig {\r\n    // the actual hbase configuration information\r\n    override val hadoopConfiguration = hadoopConfigProvider.hadoopConfiguration\r\n\r\n    override val hbaseConfiguration =\r\n      HBaseConfiguration.create(hadoopConfiguration)\r\n\r\n    override val sourceUserTableOpt = sourceUserTable\r\n\r\n    // the actual parquet output configuration information\r\n    override val partitionIndex = index\r\n\r\n    override val outputBaseDir = outputBasePath\r\n\r\n    override val date = dateStr\r\n  }\r\n\r\n  object AllConfig extends AllConfig\r\n\r\n  override def config = AllConfig\r\n\r\n  // Server session ID, composed of 12 bits (0 ~ 4095) from partition index and\r\n  // 52 bits from DateTime microseconds, which is enough until Year 2100\r\n  private var serverSessionIdStart =\r\n    (index.toLong << 52) + System.currentTimeMillis() * 1000\r\n\r\n  def run(): Unit = {\r\n    if (index > 4095) {\r\n      // Chu Chao: Shall we continue in this case?\r\n      logger.warn(\r\n          s\"Partition number exceeds 12 bits (it's ${index} now), which may cause ServerSessionId collide.\")\r\n    }\r\n\r\n    logger.info(\r\n        s\"Partition index ${index} -- about to process the data for the current partition.\")\r\n\r\n    val batchSize = Integer.getInteger(\"wd.etl.UserMutateBatchSize\", 512)\r\n    dataPerProfileUser.grouped(batchSize) foreach { currentBatch =>\r\n      logger.info(\r\n          s\"Partition index ${index} -- processing a batch of ${currentBatch.size} user(s).\")\r\n\r\n      val idAndFirstServerTimePairs =\r\n        currentBatch map {\r\n          case (profileUser, dataObjects) =>\r\n            profileUser -> dataObjects\r\n              .minBy(_.getServerTime.getTime)\r\n              .getServerTime\r\n              .getTime\r\n        }\r\n\r\n      val usersVisitInfo = retrieveUsersVisitInfo(idAndFirstServerTimePairs)\r\n\r\n      val usersInfoToPersist =\r\n        currentBatch map {\r\n          case (profileUser, dataObjects) =>\r\n            val profileGroup =\r\n              wdProfileConfigService.getProfileGroup(profileUser.profileId)\r\n            val conversionPathConfig =\r\n              wdProfileConfigService.getConversionPathConfigsByProfileId(\r\n                  profileUser.profileId)\r\n            val isMobileProfile =\r\n              wdProfileConfigService.getProfileType(profileUser.profileId) == ProfileType.MOBILE\r\n            val aggregator =\r\n              new UserSessionDataAggregator(profileUser,\r\n                                            serverSessionIdStart,\r\n                                            usersVisitInfo.get(profileUser),\r\n                                            eqIdMap,\r\n                                            isMobileProfile)\r\n\r\n            val objectSeq = dataObjects.toSeq\r\n\r\n            val sessionData = {\r\n              if (isMobileProfile) groupDataObjectsForMobile(objectSeq)\r\n              else groupDataObjects(objectSeq)\r\n            }\r\n\r\n            val (visitInfo, records) =\r\n              aggregator.aggregate(sessionData, conversionPathConfig)\r\n\r\n            // update the 'the start of the session id' for allocating the ids in the following rounds\r\n            serverSessionIdStart += sessionData.size\r\n\r\n            // write the data records\r\n            writeDataRecords(profileGroup, records)\r\n\r\n            visitInfo\r\n        }\r\n\r\n      logger.info(\r\n          s\"Partition index ${index} -- trying to persist the visit stats for ${usersInfoToPersist.size} users.\")\r\n      // persist the users visit statistics back\r\n      updateUsersVisitInfo(usersInfoToPersist)\r\n\r\n      logger.info(\r\n          s\"Partition index ${index} -- done with the current batch (#user = ${currentBatch.size}).\")\r\n    }\r\n  }\r\n}\r\n\r\nobject PartitionProcessor {\r\n  private val logger = LoggerFactory.getLogger(classOf[PartitionProcessor])\r\n}\r\n\r\n```\r\n[PartitionProcessor.zip](https://github.com/olafurpg/scalafmt/files/297141/PartitionProcessor.zip)\r\n\r\n\r\ni format the PartitionProcessor.scala using scalafmt in intellij, then i diff with cli\r\n`scalafmt -f PartitionProcessor.scala  | diff  --strip-trailing-cr --ignore-blank-lines - PartitionProcessor.scala`\r\n\r\nthe output\r\n```\r\n63,64c63\r\n<     override val hadoopConfiguration =\r\n<       hadoopConfigProvider.hadoopConfiguration\r\n---\r\n>     override val hadoopConfiguration = hadoopConfigProvider.hadoopConfiguration\r\n\r\n```\r\ni don't create `.scalafmt` , both using default style and version are 0.2.5\r\nwhy results diff. \r\n"
}