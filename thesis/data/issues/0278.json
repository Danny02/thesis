{
  "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/278",
  "repository_url": "https://api.github.com/repos/olafurpg/scalafmt",
  "labels_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/278/labels{/name}",
  "comments_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/278/comments",
  "events_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/278/events",
  "html_url": "https://github.com/olafurpg/scalafmt/issues/278",
  "id": 156277317,
  "number": 278,
  "title": "scalafmt is not idempotent for this example",
  "user": {
    "login": "dabd",
    "id": 167463,
    "avatar_url": "https://avatars.githubusercontent.com/u/167463?v=3",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dabd",
    "html_url": "https://github.com/dabd",
    "followers_url": "https://api.github.com/users/dabd/followers",
    "following_url": "https://api.github.com/users/dabd/following{/other_user}",
    "gists_url": "https://api.github.com/users/dabd/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dabd/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dabd/subscriptions",
    "organizations_url": "https://api.github.com/users/dabd/orgs",
    "repos_url": "https://api.github.com/users/dabd/repos",
    "events_url": "https://api.github.com/users/dabd/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dabd/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/labels/bug",
      "name": "bug",
      "color": "fc2929"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "milestone": {
    "url": "https://api.github.com/repos/olafurpg/scalafmt/milestones/5",
    "html_url": "https://github.com/olafurpg/scalafmt/milestones/0.2.6",
    "labels_url": "https://api.github.com/repos/olafurpg/scalafmt/milestones/5/labels",
    "id": 1764113,
    "number": 5,
    "title": "0.2.6",
    "description": "",
    "creator": {
      "login": "olafurpg",
      "id": 1408093,
      "avatar_url": "https://avatars.githubusercontent.com/u/1408093?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/olafurpg",
      "html_url": "https://github.com/olafurpg",
      "followers_url": "https://api.github.com/users/olafurpg/followers",
      "following_url": "https://api.github.com/users/olafurpg/following{/other_user}",
      "gists_url": "https://api.github.com/users/olafurpg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/olafurpg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/olafurpg/subscriptions",
      "organizations_url": "https://api.github.com/users/olafurpg/orgs",
      "repos_url": "https://api.github.com/users/olafurpg/repos",
      "events_url": "https://api.github.com/users/olafurpg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/olafurpg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 13,
    "closed_issues": 15,
    "state": "open",
    "created_at": "2016-05-13 08:39:58 UTC",
    "updated_at": "2016-06-07 21:09:10 UTC",
    "due_on": "2016-06-29 22:00:00 UTC",
    "closed_at": null
  },
  "comments": [
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/220976720",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/278#issuecomment-220976720",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/278",
      "id": 220976720,
      "user": {
        "login": "olafurpg",
        "id": 1408093,
        "avatar_url": "https://avatars.githubusercontent.com/u/1408093?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/olafurpg",
        "html_url": "https://github.com/olafurpg",
        "followers_url": "https://api.github.com/users/olafurpg/followers",
        "following_url": "https://api.github.com/users/olafurpg/following{/other_user}",
        "gists_url": "https://api.github.com/users/olafurpg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/olafurpg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/olafurpg/subscriptions",
        "organizations_url": "https://api.github.com/users/olafurpg/orgs",
        "repos_url": "https://api.github.com/users/olafurpg/repos",
        "events_url": "https://api.github.com/users/olafurpg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/olafurpg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-05-23 13:15:20 UTC",
      "updated_at": "2016-05-23 13:15:20 UTC",
      "body": "What settings are you using?"
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/221507597",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/278#issuecomment-221507597",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/278",
      "id": 221507597,
      "user": {
        "login": "olafurpg",
        "id": 1408093,
        "avatar_url": "https://avatars.githubusercontent.com/u/1408093?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/olafurpg",
        "html_url": "https://github.com/olafurpg",
        "followers_url": "https://api.github.com/users/olafurpg/followers",
        "following_url": "https://api.github.com/users/olafurpg/following{/other_user}",
        "gists_url": "https://api.github.com/users/olafurpg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/olafurpg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/olafurpg/subscriptions",
        "organizations_url": "https://api.github.com/users/olafurpg/orgs",
        "repos_url": "https://api.github.com/users/olafurpg/repos",
        "events_url": "https://api.github.com/users/olafurpg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/olafurpg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-05-25 08:31:17 UTC",
      "updated_at": "2016-05-25 08:31:17 UTC",
      "body": "I was able to reproduce the issue. I will try to fix this asap, thanks for reporting."
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/221648768",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/278#issuecomment-221648768",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/278",
      "id": 221648768,
      "user": {
        "login": "olafurpg",
        "id": 1408093,
        "avatar_url": "https://avatars.githubusercontent.com/u/1408093?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/olafurpg",
        "html_url": "https://github.com/olafurpg",
        "followers_url": "https://api.github.com/users/olafurpg/followers",
        "following_url": "https://api.github.com/users/olafurpg/following{/other_user}",
        "gists_url": "https://api.github.com/users/olafurpg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/olafurpg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/olafurpg/subscriptions",
        "organizations_url": "https://api.github.com/users/olafurpg/orgs",
        "repos_url": "https://api.github.com/users/olafurpg/repos",
        "events_url": "https://api.github.com/users/olafurpg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/olafurpg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-05-25 17:33:31 UTC",
      "updated_at": "2016-05-25 17:36:13 UTC",
      "body": "I've tracked down the issue to scalafmt's escape hatch when the search space grows out of bounds. The escape hatch seems to be non-idempotent in some cases (not triggered by the 1.2 million LOC in my tests).\r\n\r\nEach application, select and lambda (8 nested in your example) increases the search space by an exponential factor. For detailsÂ why this is a challenge, see http://journal.stuffwithstuff.com/2015/09/08/the-hardest-program-ive-ever-written/\r\n\r\nThe best solution I can come up with is to change the default behaviour to leave entire troublesome statements unformatted instead of doing a best-effort like it currently does. Once scalafmt's search algorithm improves that escape hatch will be triggered in fewer cases. The best-effort formatting can then be enabled via a flag at the risk of getting non-idempotent formatting."
    },
    {
      "url": "https://api.github.com/repos/olafurpg/scalafmt/issues/comments/221649638",
      "html_url": "https://github.com/olafurpg/scalafmt/issues/278#issuecomment-221649638",
      "issue_url": "https://api.github.com/repos/olafurpg/scalafmt/issues/278",
      "id": 221649638,
      "user": {
        "login": "olafurpg",
        "id": 1408093,
        "avatar_url": "https://avatars.githubusercontent.com/u/1408093?v=3",
        "gravatar_id": "",
        "url": "https://api.github.com/users/olafurpg",
        "html_url": "https://github.com/olafurpg",
        "followers_url": "https://api.github.com/users/olafurpg/followers",
        "following_url": "https://api.github.com/users/olafurpg/following{/other_user}",
        "gists_url": "https://api.github.com/users/olafurpg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/olafurpg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/olafurpg/subscriptions",
        "organizations_url": "https://api.github.com/users/olafurpg/orgs",
        "repos_url": "https://api.github.com/users/olafurpg/repos",
        "events_url": "https://api.github.com/users/olafurpg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/olafurpg/received_events",
        "type": "User",
        "site_admin": false
      },
      "created_at": "2016-05-25 17:36:40 UTC",
      "updated_at": "2016-05-25 17:36:40 UTC",
      "body": "FWIW, here's how scalafmt sees the statement\r\n\r\n<img width=\"1178\" alt=\"screen shot 2016-05-25 at 19 19 34\" src=\"https://cloud.githubusercontent.com/assets/1408093/15549993/9f40fdcc-22af-11e6-8706-8ac935f65c2b.png\">\r\n\r\nThe escape hatch is triggered between `saUtr` and `,` when the search algorithm has visited that pair over 200 times. Disabling the escape hatch makes the statement format optimally after ~5k state visits, which isn't so bad at all. But you only need a few more nestings to make that search intractable."
    }
  ],
  "created_at": "2016-05-23 13:12:44 UTC",
  "updated_at": "2016-05-25 17:36:40 UTC",
  "closed_at": null,
  "body": "Using settings: \r\n--maxColumn 140\r\n\r\nOriginal:\r\n```scala\r\ntrait SelfEmploymentsBalancingChargesController extends BaseController with Links {\r\n\r\n  val balancingChargesJson = toJson(\r\n    balancingCharges.map(balancingCharge =>\r\n      halResource(\r\n        obj(),\r\n        Seq(HalLink(\"self\",\r\n          selfEmploymentSummaryTypeIdHref(saUtr, taxYear, seId, BalancingChargesSummaryType, balancingCharge.id.get))))))\r\n}\r\n\r\n```\r\n\r\nScalafmt:\r\n```scala\r\ntrait SelfEmploymentsBalancingChargesController extends BaseController with Links {\r\n\r\n  val balancingChargesJson = toJson(\r\n      balancingCharges.map(balancingCharge =>\r\n            halResource(obj(),\r\n                        Seq(HalLink(\"self\",\r\n                                    selfEmploymentSummaryTypeIdHref(\r\n                                        saUtr, taxYear, seId, BalancingChargesSummaryType, balancingCharge.id.get))))))\r\n}\r\n```\r\n\r\nWhen applying the formatter repeatedly the output varies between:\r\n```scala\r\ntrait SelfEmploymentsBalancingChargesController extends BaseController with Links {\r\n\r\n  val balancingChargesJson = toJson(\r\n      balancingCharges.map(balancingCharge =>\r\n            halResource(\r\n                obj(),\r\n                Seq(HalLink(\"self\",\r\n                            selfEmploymentSummaryTypeIdHref(saUtr, taxYear, seId, BalancingChargesSummaryType, balancingCharge.id.get))))))\r\n}\r\n\r\n```\r\nand\r\n\r\n```scala\r\ntrait SelfEmploymentsBalancingChargesController extends BaseController with Links {\r\n\r\n  val balancingChargesJson = toJson(\r\n      balancingCharges.map(balancingCharge =>\r\n            halResource(obj(),\r\n                        Seq(HalLink(\"self\",\r\n                                    selfEmploymentSummaryTypeIdHref(\r\n                                        saUtr, taxYear, seId, BalancingChargesSummaryType, balancingCharge.id.get))))))\r\n}\r\n```\r\n\r\nUsing\r\n* 0.2.5\r\n"
}